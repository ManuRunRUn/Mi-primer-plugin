name: Compilar XtremeStreamer
on: [push, workflow_dispatch]

jobs:
  build:
    runs-on: ubuntu-latest
    container: devkitpro/devkitppc:latest
    steps:
      - name: Obtener codigo
        uses: actions/checkout@v4

      - name: Instalar Dependencias (Fuerza Bruta)
        run: |
          # 1. Actualizamos e instalamos wget (para poder descargar cosas)
          dkp-pacman -Sy
          dkp-pacman -S wiiu-dev wget --noconfirm

          # 2. Descargamos WUPS y WUPS-TOOL manualmente (Versi√≥n Aroma 0.10.1)
          # Usamos estos enlaces fijos que NO dan error 404
          wget https://github.com/wiiu-env/WiiUPluginSystem/releases/download/v0.10.1/wups-0.10.1-1-any.pkg.tar.xz
          wget https://github.com/wiiu-env/WiiUPluginSystem/releases/download/v0.10.1/wups-tool-linux.tar.gz

          # 3. Instalamos WUPS a la fuerza
          tar -xJf wups-0.10.1-1-any.pkg.tar.xz -C /

          # 4. Instalamos WUPS-TOOL a la fuerza
          tar -xzf wups-tool-linux.tar.gz
          cp wups-tool /opt/devkitpro/tools/bin/
          chmod +x /opt/devkitpro/tools/bin/wups-tool

      - name: Compilar Plugin
        run: |
          # Configuramos el entorno
          export DEVKITPRO=/opt/devkitpro
          export DEVKITPPC=$DEVKITPRO/devkitPPC
          export WUT_ROOT=$DEVKITPRO/wut
          export PATH=$PATH:$DEVKITPPC/bin:$DEVKITPRO/tools/bin

          # Compilamos
          make

      - name: Descargar Archivo Final
        uses: actions/upload-artifact@v4
        with:
          name: Plugin_XtremeStreamer_WiiU
          path: "*.wps"
